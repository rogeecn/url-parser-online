<!DOCTYPE html>
<html lang="{{.Lang.Code}}" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.I18N.title}}</title>
    <meta name="description" content="{{.I18N.description}}">
    <meta name="keywords" content="{{.I18N.keywords}}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{.I18N.title}}">
    <meta property="og:description" content="{{.I18N.description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{if .Base.BaseURL}}{{.Base.BaseURL}}{{end}}">
    <meta property="og:site_name" content="URL Parser Online">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{.I18N.title}}">
    <meta name="twitter:description" content="{{.I18N.description}}">

    <!-- Multi-language support -->
    {{range .LangLinks}}
    <link rel="alternate" hreflang="{{.Code}}" href="{{.URL}}">
    {{end}}

    <link href="style.css" rel="stylesheet">

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "{{.I18N.title}}",
        "description": "{{.I18N.description}}",
        "url": "{{if .Base.BaseURL}}{{.Base.BaseURL}}{{end}}",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body class="h-full bg-gray-50">
    <div class="min-h-full flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">{{.I18N.header.title}}</h1>
                            <p class="text-sm text-gray-600">{{.I18N.header.description}}</p>
                        </div>
                    </div>

                    <!-- Language Switcher -->
                    <div class="relative">
                        <button id="lang-switcher-btn" type="button" class="flex items-center gap-x-1 text-sm px-3 py-2 rounded-md bg-white text-gray-700 hover:bg-gray-50 border border-gray-200">
                            {{range .LangLinks}}
                                {{if .Current}}
                                    <span>{{.DisplayName}}</span>
                                {{end}}
                            {{end}}
                            <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="lang-switcher-dropdown" class="absolute right-0 mt-2 w-[360px] bg-white rounded-xl shadow-xl focus:outline-none z-10 overflow-hidden border border-gray-100 hidden transform opacity-0 scale-95 transition-all duration-100 ease-out">
                            <div class="p-3">
                                <div class="grid grid-cols-3 gap-2">
                                    {{range .LangLinks}}
                                    <a href="{{.URL}}" class="px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 text-center rounded-md transition duration-150 ease-in-out {{if .Current}}bg-primary-50 text-primary-700 font-medium hover:bg-primary-100{{end}}">
                                        {{.DisplayName}}
                                    </a>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- URL Parser Section -->
                <section class="mb-12">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <!-- Input Section -->
                        <div class="mb-8">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">{{.I18N.parser.inputLabel}}</h2>

                            <!-- URL Input -->
                            <div class="space-y-4">
                                <div>
                                    <textarea
                                        id="urlInput"
                                        rows="4"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 resize-none"
                                        placeholder="{{.I18N.parser.inputPlaceholder}}"
                                    ></textarea>
                                </div>

                                <!-- Control Buttons -->
                                <div class="flex flex-wrap gap-3">
                                    <button id="parseBtn" class="bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                                        {{.I18N.parser.parseButton}}
                                    </button>
                                    <button id="clearBtn" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                                        {{.I18N.parser.clearButton}}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Results Section -->
                        <div class="border-t border-gray-200 pt-8">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">{{.I18N.result.title}}</h2>

                            <!-- Status Messages -->
                            <div id="parseStatus" class="hidden mb-4"></div>

                            <!-- Parse Results -->
                            <div id="parseResults" class="space-y-4">
                                <div class="text-center text-gray-500 py-8">
                                    {{.I18N.result.empty}}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- History Section -->
                <section class="mb-12">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-semibold text-gray-900">{{.I18N.history.title}}</h2>
                            <div class="flex space-x-3">
                                <button id="clearHistory" class="text-sm bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700">
                                    {{.I18N.history.clearAll}}
                                </button>
                            </div>
                        </div>

                        <div id="historyList" class="space-y-3">
                            <div class="text-center text-gray-500 py-8">
                                {{.I18N.history.empty}}
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Knowledge Section -->
                <section>
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-2">{{.I18N.knowledge.title}}</h2>
                        <p class="text-gray-600">{{.I18N.knowledge.description}}</p>
                    </div>
                    <!-- URL Structure Overview -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">{{.I18N.knowledge.urlStructure.title}}</h3>
                        <p class="text-sm text-gray-600 mb-4">{{.I18N.knowledge.urlStructure.description}}</p>
                        <code class="block text-sm bg-gray-100 text-gray-800 p-3 rounded overflow-x-auto">{{.I18N.knowledge.urlStructure.details}}</code>
                    </div>
                    <!-- URL Components Table -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="pl-8 pr-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6">组件</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/6">描述</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-3/6">详细信息</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <!-- Scheme -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.scheme.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.scheme.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.scheme.details}}</p>
                                    </td>
                                </tr>

                                <!-- Authority -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.authority.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.authority.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.authority.details}}</p>
                                    </td>
                                </tr>

                                <!-- Host -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.host.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.host.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.host.details}}</p>
                                    </td>
                                </tr>

                                <!-- Port -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.port.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.port.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.port.details}}</p>
                                    </td>
                                </tr>

                                <!-- Path -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.path.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.path.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.path.details}}</p>
                                    </td>
                                </tr>

                                <!-- Query -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.query.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.query.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.query.details}}</p>
                                    </td>
                                </tr>

                                <!-- Fragment -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.fragment.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.fragment.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.fragment.details}}</p>
                                    </td>
                                </tr>

                                <!-- UserInfo -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.userinfo.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.userinfo.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.userinfo.details}}</p>
                                    </td>
                                </tr>

                                <!-- Encoding -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.encoding.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.encoding.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.encoding.details}}</p>
                                    </td>
                                </tr>

                                <!-- Relative URLs -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18M13 8l4-4m0 0l-4-4m4 4H3"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.relative.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.relative.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.relative.details}}</p>
                                    </td>
                                </tr>

                                <!-- Standards -->
                                <tr>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-gray-900">{{.I18N.knowledge.standards.title}}</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-600">{{.I18N.knowledge.standards.description}}</p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-sm text-gray-500">{{.I18N.knowledge.standards.details}}</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

    </div>

    <script>
        // Global variables and constants
        const I18N = {
            "error": {
                "invalidUrl": "{{.I18N.error.invalidUrl}}"
            },
            "result": {
                "empty": "{{.I18N.result.empty}}",
                "protocol": "{{.I18N.result.protocol}}",
                "userInfo": "{{.I18N.result.userInfo}}",
                "host": "{{.I18N.result.host}}",
                "port": "{{.I18N.result.port}}",
                "path": "{{.I18N.result.path}}",
                "query": "{{.I18N.result.query}}",
                "fragment": "{{.I18N.result.fragment}}",
                "copyButton": "{{.I18N.result.copyButton}}",
                "copySuccess": "{{.I18N.result.copySuccess}}"
            },
            "history": {
                "empty": "{{.I18N.history.empty}}",
                "parseAgain": "{{.I18N.history.parseAgain}}",
                "delete": "{{.I18N.history.delete}}"
            }
        };
        let urlHistory = JSON.parse(localStorage.getItem('urlHistory') || '[]');

        // DOM elements
        const urlInput = document.getElementById('urlInput');
        const parseBtn = document.getElementById('parseBtn');
        const clearBtn = document.getElementById('clearBtn');
        const parseResults = document.getElementById('parseResults');
        const parseStatus = document.getElementById('parseStatus');
        const historyList = document.getElementById('historyList');

        // URL parsing functionality
        function parseURL(urlString) {
            try {
                // Handle multiple URLs (batch mode)
                const urls = urlString.split('\n').filter(url => url.trim());
                const results = [];

                for (const url of urls) {
                    const trimmedUrl = url.trim();
                    if (!trimmedUrl) continue;

                    try {
                        const urlObj = new URL(trimmedUrl);
                        const parsed = {
                            original: trimmedUrl,
                            protocol: urlObj.protocol,
                            userInfo: urlObj.username ? `${urlObj.username}${urlObj.password ? ':' + urlObj.password : ''}` : '',
                            host: urlObj.hostname,
                            port: urlObj.port || getDefaultPort(urlObj.protocol),
                            path: urlObj.pathname,
                            query: urlObj.search,
                            fragment: urlObj.hash,
                            isValid: true
                        };
                        results.push(parsed);

                        // Save to history
                        saveToHistory(parsed);
                    } catch (e) {
                        results.push({
                            original: trimmedUrl,
                            isValid: false,
                            error: I18N.error.invalidUrl
                        });
                    }
                }

                return results;
            } catch (e) {
                return [{
                    original: urlString,
                    isValid: false,
                    error: I18N.error.invalidUrl
                }];
            }
        }

        function getDefaultPort(protocol) {
            const defaults = {
                'http:': '80',
                'https:': '443',
                'ftp:': '21',
                'ftps:': '990'
            };
            return defaults[protocol] || '';
        }

        function renderParseResults(results) {
            if (!results || results.length === 0) {
                parseResults.innerHTML = `<div class="text-center text-gray-500 py-8">${I18N.result.empty}</div>`;
                return;
            }

            // Filter out invalid results and valid results
            const validResults = results.filter(result => result.isValid);
            const invalidResults = results.filter(result => !result.isValid);

            let html = '';

            // Show invalid URLs first
            if (invalidResults.length > 0) {
                html += '<div class="mb-6">';
                invalidResults.forEach(result => {
                    html += `
                        <div class="border border-red-200 rounded-md p-4 bg-red-50 mb-3">
                            <div class="text-sm text-red-600">${result.error}</div>
                            <div class="text-xs text-gray-500 mt-1">${result.original}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Show valid results in table format
            if (validResults.length > 0) {
                html += '<div class="overflow-x-auto">';
                html += '<table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg">';

                // Table header
                html += '<thead class="bg-gray-50">';
                html += '<tr>';
                html += '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Component</th>';

                validResults.forEach((result, index) => {
                    html += `<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ${index < validResults.length - 1 ? 'border-r border-gray-200' : ''}">`;
                    html += `<div class="flex items-center justify-between">`;
                    html += `<span>URL ${index + 1}</span>`;
                    html += `<button onclick="copyToClipboard('${result.original.replace(/'/g, "\\'")}', this)" class="ml-2 text-xs bg-primary-100 text-primary-700 px-2 py-1 rounded hover:bg-primary-200">${I18N.result.copyButton}</button>`;
                    html += `</div>`;
                    html += `<div class="text-xs font-normal text-gray-700 mt-1 truncate" title="${result.original}">${result.original}</div>`;
                    html += '</th>';
                });
                html += '</tr>';
                html += '</thead>';

                // Table body
                html += '<tbody class="bg-white divide-y divide-gray-200">';

                // Define rows to display
                const rows = [
                    { key: 'protocol', label: I18N.result.protocol },
                    { key: 'userInfo', label: I18N.result.userInfo },
                    { key: 'host', label: I18N.result.host },
                    { key: 'port', label: I18N.result.port },
                    { key: 'path', label: I18N.result.path },
                    { key: 'query', label: I18N.result.query },
                    { key: 'fragment', label: I18N.result.fragment }
                ];

                rows.forEach((row, rowIndex) => {
                    // Skip empty rows (where all URLs have empty values)
                    const hasValues = validResults.some(result => {
                        if (row.key === 'query') {
                            return result[row.key] && result[row.key] !== '';
                        }
                        return result[row.key] && result[row.key] !== '';
                    });

                    if (!hasValues && row.key !== 'protocol' && row.key !== 'host' && row.key !== 'path') {
                        return; // Skip this row if no URL has this component
                    }

                    html += `<tr class="${rowIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">`;
                    html += `<td class="px-4 py-3 text-sm font-medium text-gray-900 border-r border-gray-200">${row.label}</td>`;

                    validResults.forEach((result, index) => {
                        html += `<td class="px-4 py-3 text-sm text-gray-700 ${index < validResults.length - 1 ? 'border-r border-gray-200' : ''}">`;

                        if (row.key === 'query' && result[row.key]) {
                            // Parse and display query parameters in multiple rows
                            const queryString = result[row.key].substring(1); // Remove leading '?'
                            if (queryString) {
                                const params = new URLSearchParams(queryString);
                                const paramArray = Array.from(params.entries());
                                if (paramArray.length > 0) {
                                    html += '<div class="space-y-1">';
                                    paramArray.forEach(([key, value]) => {
                                        html += `<div class="text-xs"><span class="font-medium">${key}:</span> ${value}</div>`;
                                    });
                                    html += '</div>';
                                } else {
                                    html += '<span class="text-gray-400">-</span>';
                                }
                            } else {
                                html += '<span class="text-gray-400">-</span>';
                            }
                        } else {
                            const value = result[row.key];
                            if (value && value !== '') {
                                html += `<span class="break-all">${value}</span>`;
                            } else {
                                html += '<span class="text-gray-400">-</span>';
                            }
                        }

                        html += '</td>';
                    });
                    html += '</tr>';
                });

                html += '</tbody>';
                html += '</table>';
                html += '</div>';
            }

            parseResults.innerHTML = html;
        }

        // History management
        function saveToHistory(parsedUrl) {
            const historyItem = {
                ...parsedUrl,
                timestamp: Date.now(),
                id: Math.random().toString(36).substr(2, 9)
            };

            // Remove duplicate URLs
            urlHistory = urlHistory.filter(item => item.original !== parsedUrl.original);

            // Add to beginning
            urlHistory.unshift(historyItem);

            // Keep only last 50 items
            if (urlHistory.length > 50) {
                urlHistory = urlHistory.slice(0, 50);
            }

            localStorage.setItem('urlHistory', JSON.stringify(urlHistory));
        }

        function renderHistory() {
            if (urlHistory.length === 0) {
                historyList.innerHTML = `<div class="text-center text-gray-500 py-8">${I18N.history.empty}</div>`;
                return;
            }

            const html = urlHistory.map(item => `
                <div class="border border-gray-200 rounded-md p-4 hover:bg-gray-50">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-900 truncate">${item.original}</div>
                            <div class="text-xs text-gray-500">${new Date(item.timestamp).toLocaleString()}</div>
                        </div>
                        <div class="flex items-center space-x-2 ml-4">
                            <button onclick="loadFromHistory('${item.id}')"
                                    class="text-xs bg-primary-100 text-primary-700 px-2 py-1 rounded hover:bg-primary-200">
                                ${I18N.history.parseAgain}
                            </button>
                            <button onclick="removeFromHistory('${item.id}')"
                                    class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200">
                                ${I18N.history.delete}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            historyList.innerHTML = html;
        }

        function loadFromHistory(id) {
            const item = urlHistory.find(h => h.id === id);
            if (item) {
                urlInput.value = item.original;
                parseBtn.click();
            }
        }

        function removeFromHistory(id) {
            urlHistory = urlHistory.filter(h => h.id !== id);
            localStorage.setItem('urlHistory', JSON.stringify(urlHistory));
            renderHistory();
        }

        function clearAllHistory() {
            if (confirm('Are you sure you want to clear all history?')) {
                urlHistory = [];
                localStorage.setItem('urlHistory', JSON.stringify(urlHistory));
                renderHistory();
            }
        }

        // Utility functions
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = I18N.result.copySuccess;
                button.classList.remove('bg-primary-100', 'text-primary-700');
                button.classList.add('bg-green-100', 'text-green-700');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-100', 'text-green-700');
                    button.classList.add('bg-primary-100', 'text-primary-700');
                }, 2000);
            });
        }

        function showStatus(message, type = 'info') {
            const colors = {
                success: 'bg-green-50 border-green-200 text-green-800',
                warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
                error: 'bg-red-50 border-red-200 text-red-800',
                info: 'bg-blue-50 border-blue-200 text-blue-800'
            };

            parseStatus.className = `p-3 rounded-md border ${colors[type]}`;
            parseStatus.textContent = message;
            parseStatus.classList.remove('hidden');

            setTimeout(() => {
                parseStatus.classList.add('hidden');
            }, 5000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Parse button
            parseBtn.addEventListener('click', () => {
                const urlText = urlInput.value.trim();
                if (!urlText) {
                    showStatus(I18N.result.empty, 'warning');
                    return;
                }

                const results = parseURL(urlText);
                renderParseResults(results);
            });

            // Clear button
            clearBtn.addEventListener('click', () => {
                urlInput.value = '';
                parseResults.innerHTML = `<div class="text-center text-gray-500 py-8">${I18N.result.empty}</div>`;
                parseStatus.classList.add('hidden');
            });

            // History clear
            document.getElementById('clearHistory').addEventListener('click', clearAllHistory);

            // Load history on page load
            renderHistory();
        });
    </script>

    <!-- Language Switcher Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('lang-switcher-btn');
            const dropdown = document.getElementById('lang-switcher-dropdown');
            let isOpen = false;

            // Toggle dropdown
            function toggleDropdown() {
                isOpen = !isOpen;
                if (isOpen) {
                    dropdown.classList.remove('hidden');
                    // 使用 setTimeout 来确保 hidden 被移除后再添加动画类
                    setTimeout(() => {
                        dropdown.classList.remove('opacity-0', 'scale-95');
                        dropdown.classList.add('opacity-100', 'scale-100');
                    }, 10);
                } else {
                    dropdown.classList.remove('opacity-100', 'scale-100');
                    dropdown.classList.add('opacity-0', 'scale-95');
                    // 等待过渡动画完成后再隐藏元素
                    setTimeout(() => {
                        dropdown.classList.add('hidden');
                    }, 100);
                }
            }

            // 点击按钮切换下拉菜单
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown();
            });

            // 点击下拉菜单内部时阻止冒泡，避免触发外部点击事件
            dropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // 点击页面其他部分关闭下拉菜单
            document.addEventListener('click', function() {
                if (isOpen) {
                    toggleDropdown();
                }
            });

            // 按 ESC 键关闭下拉菜单
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isOpen) {
                    toggleDropdown();
                }
            });
        });
    </script>
</head>
